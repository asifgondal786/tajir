{"version":3,"file":"decode.umd.js","mappings":";CAAA,SAA2CA,EAAMC,GAC1B,iBAAZC,SAA0C,iBAAXC,OACxCA,OAAOD,QAAUD,IACQ,mBAAXG,QAAyBA,OAAOC,IAC9CD,OAAO,GAAIH,GACe,iBAAZC,QACdA,QAAe,MAAID,IAEnBD,EAAY,MAAIC,IARlB,CASGK,MAAM,uBCRT,IAAIC,EAAsB,CCA1BA,EAAwB,CAACL,EAASM,KACjC,IAAI,IAAIC,KAAOD,EACXD,EAAoBG,EAAEF,EAAYC,KAASF,EAAoBG,EAAER,EAASO,IAC5EE,OAAOC,eAAeV,EAASO,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,MCJ3EF,EAAwB,CAACQ,EAAKC,IAAUL,OAAOM,UAAUC,eAAeC,KAAKJ,EAAKC,GCClFT,EAAyBL,IACH,oBAAXkB,QAA0BA,OAAOC,aAC1CV,OAAOC,eAAeV,EAASkB,OAAOC,YAAa,CAAEC,MAAO,WAE7DX,OAAOC,eAAeV,EAAS,aAAc,CAAEoB,OAAO,WCiChD,SAASC,EAAWC,EAAWC,EAAWC,EAAWC,EAAY,KACtE,QAAa,IAAJA,IAAa,IAAU,IAAJD,IAAa,IAAU,IAAJD,IAAa,EAAS,IAAJD,KAAe,EAO3E,SAASI,EAAaC,GAC3B,MAAO,CAAS,IAARA,EAAeA,GAAS,EAAK,IAAOA,GAAS,GAAM,IAAMA,IAAU,IAqEtE,SAASC,EAAaN,EAAWC,EAAWC,GACjD,OAAQ,WAAaK,KAAKC,MAAMN,EAAI,IAAM,MAAQ,GAAKK,KAAKC,MAAMP,EAAI,IAAM,MAAQ,EAAIM,KAAKC,MAAMR,EAAI,IAAM,QAAU,gMAzGnC,MAA5D,IAAIS,WAAW,IAAIC,YAAY,CAAC,aAAaC,QAAQ,IAE7EC,QAAQC,KAAK,+EAmJR,MAAMC,EAAsB,IAAIJ,YAAY,CACjDJ,EAAc,EAAI,EAAI,GACtBA,EAAa,GAAI,GAAI,IACrBA,EAAa,GAAI,GAAI,IACrBA,EAAa,GAAI,GAAI,IACrBA,EAAa,GAAI,GAAI,IACrBA,EAAa,GAAI,GAAI,IACrBA,EAAa,GAAI,GAAI,IACrBA,EAAa,GAAI,GAAI,IACrBA,EAAa,GAAI,GAAI,IACrBA,EAAa,GAAI,GAAI,IACrBA,EAAa,GAAI,GAAI,IACrBA,EAAa,GAAI,GAAI,IACrBA,EAAa,GAAI,GAAI,IACrBA,EAAa,GAAI,GAAI,IACrBA,EAAa,GAAI,GAAI,IACrBA,EAAa,GAAI,GAAI,MA2BVS,EAAqB,IAAIL,YAAY,CAChDJ,EAAc,EAAI,EAAI,GACtBA,EAAa,GAAI,GAAI,IACrBA,EAAa,GAAI,GAAI,IACrBA,EAAa,GAAI,GAAI,IACrBA,EAAc,EAAI,EAAI,GACtBA,EAAa,GAAI,GAAI,IACrBA,EAAa,GAAI,GAAI,IACrBA,EAAa,GAAI,GAAI,IACrBA,EAAc,EAAI,EAAI,GACtBA,EAAa,GAAI,GAAI,IACrBA,EAAa,GAAI,GAAI,IACrBA,EAAa,GAAI,GAAI,IACrBA,EAAc,EAAI,EAAI,GACtBA,EAAa,GAAI,GAAI,IACrBA,EAAa,GAAI,GAAI,IACrBA,EAAa,GAAI,GAAI,MAQVU,EAAmB,MAE9B,MAAMC,EAAgB,CACpBlB,EAAW,EAAG,EAAG,GACjBA,EAAW,IAAK,EAAG,GACnBA,EAAW,EAAG,IAAK,GACnBA,EAAW,IAAK,IAAK,GACrBA,EAAW,EAAG,EAAG,KACjBA,EAAW,IAAK,EAAG,KACnBA,EAAW,EAAG,IAAK,KACnBA,EAAW,IAAK,IAAK,KACrBA,EAAW,IAAK,IAAK,KACrBA,EAAW,IAAK,EAAG,GACnBA,EAAW,EAAG,IAAK,GACnBA,EAAW,IAAK,IAAK,GACrBA,EAAW,GAAI,GAAI,KACnBA,EAAW,IAAK,EAAG,KACnBA,EAAW,EAAG,IAAK,KACnBA,EAAW,IAAK,IAAK,MAGjBmB,EAAI,CAAC,EAAG,GAAI,IAAK,IAAK,IAAK,KACjC,IAAK,IAAIlB,EAAI,EAAGA,EAAI,IAAKA,EACvB,IAAK,IAAIC,EAAI,EAAGA,EAAI,IAAKA,EACvB,IAAK,IAAIC,EAAI,EAAGA,EAAI,IAAKA,EACvBe,EAAEE,KAAKpB,EAAWmB,EAAElB,GAAIkB,EAAEjB,GAAIiB,EAAEhB,KAKtC,IAAK,IAAIkB,EAAI,EAAGA,GAAK,IAAKA,GAAK,GAC7BH,EAAEE,KAAKpB,EAAWqB,EAAGA,EAAGA,IAE1B,OAAO,IAAIV,YAAYO,IAjCO,GA2CnBI,EAA+BtB,EAAW,EAAG,EAAG,EAAG,KACnDuB,EAA+BvB,EAAW,IAAK,IAAK,IAAK,KC/QzDwB,EACC,MADDA,EAEG,KAFHA,EAGA,MCmBPC,EAZN,SAAsBC,GACpB,GAAsB,oBAAXC,OACT,OAAOA,OAAOC,KAAKF,EAAG,UAExB,MAAMG,EAAaC,KAAKJ,GAClBK,EAAS,IAAIrB,WAAWmB,EAAWG,QACzC,IAAK,IAAIC,EAAI,EAAGA,EAAIF,EAAOC,SAAUC,EACnCF,EAAOE,GAAKJ,EAAWK,WAAWD,GAEpC,OAAOF,EAGUI,CDlBV,oldCmBT,IAAIC,EAGJ,MAAMC,EAAc,IAAI1B,YAIxB,MAAM2B,EAAN,cACS,KAAAC,YAAeC,GAAkB,EACjC,KAAAC,YAAeC,GAAoB,EACnCC,YAAYH,GACjB,OAAOI,KAAKL,YAAYC,GAEnBK,YAAYH,GACjB,OAAOE,KAAKH,YAAYC,IAM5B,MAAMI,EAA2C,CAC/CC,YAAa,UACbC,WAAYzB,EACZ0B,UAAW3B,EACX4B,QAASnC,EACToC,aAAc3B,EACd4B,UAAU,GAQL,SAASC,EAAaC,GAC3B,MAAMC,EAAU,IAAIjB,EACdkB,EAAY,CAChBC,IAAK,CACHd,YAAaY,EAAQZ,YAAYe,KAAKH,GACtCV,YAAaU,EAAQV,YAAYa,KAAKH,KAG1C,OAAOI,YAAYC,YAAYxB,GAAeX,EAAY+B,GACvDK,MAAMC,IACL1B,EAAcA,GAAe0B,EAAKlF,OAC3B,IAAImF,EAAQT,EAAMQ,EAAKE,UAAYF,EAAMP,MAqC/C,MAAMQ,EAwGXE,YACEX,EACAY,EACAC,GAGA,GAvGM,KAAAC,cAAgB5C,MAEhB,KAAA6C,QAAuBhC,EACvB,KAAAiC,YAAwB,GACxB,KAAAC,UAAY,EACZ,KAAAC,UAAYhD,EACZ,KAAAiD,YAAc,EACd,KAAAC,eAAiB,EA+FvB9B,KAAK+B,MAAQvF,OAAOwF,OAAO,GAAI9B,EAAiBQ,GAC5CV,KAAK+B,MAAMxB,aAAe3B,EAC5B,MAAM,IAAIqD,MAAM,oDAElB,GAAKX,EASHC,EAAU5B,YAAcK,KAAKkC,aAAapB,KAAKd,MAC/CuB,EAAU1B,YAAcG,KAAKmC,YAAYrB,KAAKd,UAVhC,CACd,MAAMhE,EAASwD,IAAgBA,EAAc,IAAIuB,YAAYqB,OAAOvD,IACpEyC,EAAY,IAAIP,YAAYsB,SAASrG,EAAQ,CAC3C6E,IAAK,CACHd,YAAaC,KAAKkC,aAAapB,KAAKd,MACpCC,YAAaD,KAAKmC,YAAYrB,KAAKd,SAOzCA,KAAKsB,UAAYA,EACjBtB,KAAKsC,MAAQtC,KAAKsB,UAAUvF,QAC5BiE,KAAKuC,OAAS,IAAIzE,WAAWkC,KAAKsC,MAAME,OAAOxE,OAAQgC,KAAKsC,MAAMG,oBAAqB7D,GACvFoB,KAAK0C,QAAU,IAAI3E,YAAYiC,KAAKsC,MAAME,OAAOxE,OAAQgC,KAAKsC,MAAMK,oBAAqB,IACzF3C,KAAK4C,SAAW,IAAI7E,YAAYiC,KAAKsC,MAAME,OAAOxE,OAAQgC,KAAKsC,MAAMO,sBAAuBjE,GAC5FoB,KAAK4C,SAASE,IAAI9C,KAAK+B,MAAMzB,SAC7BN,KAAK+C,MAAQ,IAAIhF,YAAYiC,KAAKsC,MAAME,OAAOxE,OAAQgC,KAAKsC,MAAMU,kBAClEhD,KAAKsC,MAAMW,KAAKtE,EAAoB,EAAGqB,KAAK+B,MAAMxB,aAAc,GAnHtD2C,iBAAyB,OAAOlD,KAAK0C,QAAQ,GAC7CS,gBAAsB,OAAOnD,KAAK0C,QAAQ,GAC1CU,mBAAyB,OAAOpD,KAAK0C,QAAQ,GAC7CW,oBAA0B,OAAOrD,KAAK0C,QAAQ,GAC9CY,aAAmB,OAAOtD,KAAK0C,QAAQ,GAAK1C,KAAK0C,QAAQ,GAAK,EAAI,EAClEa,cAAoB,OAAOvD,KAAK0C,QAAQ,GACxCc,aAAmB,OAAOxD,KAAK0C,QAAQ,GACvCe,YAAqB,OAAOzD,KAAK0C,QAAQ,IACzCgB,oBAA0B,OAAO1D,KAAK0C,QAAQ,IAElDP,YAAYrC,GAClB,GAAa,IAATA,EAAuB,CACzB,MAAM6D,EAAS3D,KAAKJ,MAAQI,KAAK4D,OACjC,GAAID,EAAS3D,KAAKyB,QAAQrC,OAAQ,CAChC,GAAIY,KAAK+B,MAAM5B,aAAwB,EAATwD,EAAa3D,KAAK+B,MAAM5B,YAEpD,MADAH,KAAK6D,UACC,IAAI5B,MAAM,8BAElBjC,KAAKyB,QAAU,IAAI1D,YAAY4F,GAEjC3D,KAAK2B,UAAY3B,KAAKsD,YACjB,GAAa,IAATxD,EACT,GAAoB,IAAhBE,KAAKwD,OAAc,CAErB,MAAMG,EAAS/F,KAAKkG,IAAI9D,KAAKoD,aAAcxE,GAAoBoB,KAAKqD,cACpE,GAAIM,EAAS3D,KAAKyB,QAAQrC,OAAQ,CAChC,GAAIY,KAAK+B,MAAM5B,aAAwB,EAATwD,EAAa3D,KAAK+B,MAAM5B,YAEpD,MADAH,KAAK6D,UACC,IAAI5B,MAAM,8BAElBjC,KAAKyB,QAAU,IAAI1D,YAAY4F,SAI7B3D,KAAKyB,QAAQrC,OAAS,QACxBY,KAAKyB,QAAU,IAAI1D,YAAY,QAIrC,OAAO,EAGDgG,SAASC,EAAgBC,GAC/B,MAAMN,EAASK,EAASC,EACxB,GAAIN,EAAS3D,KAAKyB,QAAQrC,OAAQ,CAChC,GAAIY,KAAK+B,MAAM5B,aAAwB,EAATwD,EAAa3D,KAAK+B,MAAM5B,YAEpD,MADAH,KAAK6D,UACC,IAAI5B,MAAM,8BAGlB,MAAMiC,EAAY,IAAInG,YAAwC,MAA5BH,KAAKuG,KAAKR,EAAS,QACrDO,EAAUpB,IAAI9C,KAAKyB,SACnBzB,KAAKyB,QAAUyC,GAIXhC,aAAatC,GACnB,MAAMwE,EAAMpE,KAAKwB,cACjB,IAAIwC,EAAShE,KAAK6B,YAClB,GAAmB,IAAf7B,KAAKyD,MAAwB,CAC/B,IAAIY,EAAYrE,KAAK4D,OAAS5D,KAAK8B,eAC/BwC,EAAI,EACR,KAAOA,EAAI,GAAKD,EAAY,GAC1BrE,KAAKyB,QAAQqB,IAAI9C,KAAK+C,MAAMwB,SAASH,EAAME,EAAGF,EAAME,EAAI1E,GAAQoE,EAASpE,EAAQ0E,GACjFA,IACAD,IAEFrE,KAAK6B,aAAejC,EAAQ0E,EAC5BtE,KAAK8B,gBAAkBwC,OAClB,GAAmB,IAAftE,KAAKyD,MAAwB,CACtCzD,KAAK+D,SAASC,EAAgB,EAARpE,GACtBI,KAAK2B,UAAY/D,KAAK4G,IAAIxE,KAAK2B,UAAW/B,GAC1CI,KAAK4B,UAAYhE,KAAKkG,IAAI9D,KAAK4B,UAAWhC,GAC1C,IAAK,IAAIP,EAAI,EAAGA,EAAI,IAAKA,EACvBW,KAAKyB,QAAQqB,IAAI9C,KAAK+C,MAAMwB,SAASH,EAAM/E,EAAG+E,EAAM/E,EAAIO,GAAQoE,EAASpE,EAAQP,GAEnFW,KAAK0B,YAAYlD,KAAKoB,GACtBI,KAAK6B,aAAuB,EAARjC,EACpBI,KAAK8B,gBAAkB,EAEzB,OAAO,EA2CElC,YACT,OAAsB,IAAfI,KAAKyD,MACRzD,KAAKsD,OACL1F,KAAK4G,IAAIxE,KAAK2B,UAAW3B,KAAKsC,MAAMmC,iBAQ/Bb,aACT,OAAsB,IAAf5D,KAAKyD,MACRzD,KAAKuD,QACLvD,KAAKsC,MAAMmC,gBACiB,EAA1BzE,KAAK0B,YAAYtC,OAAaY,KAAKsC,MAAMoC,iBACf,EAA1B1E,KAAK0B,YAAYtC,OAMdkB,cACT,OAAON,KAAK4C,SAAS2B,SAAS,EAAGvE,KAAK0D,eAY7BiB,kBACT,OAAO3E,KAAKyB,QAAQmD,WAAa5E,KAAKsC,MAAME,OAAOxE,OAAO4G,WAAa,EAAI5E,KAAK0B,YAAYtC,OAMnFyF,iBACT,MAAO,CACLjF,MAAOI,KAAKJ,MACZgE,OAAQ5D,KAAK4D,OACb9D,KAAME,KAAKyD,MACXqB,MAAO9E,KAAKwD,OACZhD,WAAYR,KAAKmD,UACjB5C,aAAcP,KAAK0D,cACnBrD,UAAWL,KAAKkD,WAChB6B,SAAU/E,KAAK2E,YACfK,iBAAkB,CAChBC,UAAWjF,KAAK0C,QAAQ,GACxBwC,YAAalF,KAAK0C,QAAQ,GAC1B9C,MAAOI,KAAKoD,aACZQ,OAAQ5D,KAAKqD,gBAUZJ,KACL5C,EAAsBL,KAAK+B,MAAM1B,UACjCC,EAA8BN,KAAK+B,MAAMzB,QACzCC,EAAuBP,KAAK+B,MAAMxB,aAClCC,EAAoBR,KAAK+B,MAAMvB,UAE/BR,KAAKsC,MAAMW,KAAKjD,KAAK+B,MAAM3B,WAAYC,EAAWE,EAAcC,EAAW,EAAI,GAC3EF,GACFN,KAAK4C,SAASE,IAAIxC,EAAQiE,SAAS,EAAG3F,IAExCoB,KAAK0B,YAAYtC,OAAS,EAC1BY,KAAK2B,UAAY,EACjB3B,KAAK4B,UAAYhD,EACjBoB,KAAK6B,YAAc,EACnB7B,KAAK8B,eAAiB,EAOjBqD,OAAOC,EAAsBC,EAAgB,EAAGC,EAAcF,EAAKhG,QACxE,IAAId,EAAI+G,EACR,KAAO/G,EAAIgH,GAAK,CACd,MAAMlG,EAASxB,KAAKkG,IAAIwB,EAAMhH,EAAGM,GACjCoB,KAAKuC,OAAOO,IAAIsC,EAAKb,SAASjG,EAAGA,GAAKc,IACtCY,KAAKsC,MAAM6C,OAAO,EAAG/F,IASlBmG,aAAaH,EAAcC,EAAgB,EAAGC,EAAcF,EAAKhG,QACtE,IAAId,EAAI+G,EACR,KAAO/G,EAAIgH,GAAK,CACd,MAAMlG,EAASxB,KAAKkG,IAAIwB,EAAMhH,EAAGM,GACjC,IAAK,IAAIS,EAAI,EAAGmG,EAAIlH,EAAGe,EAAID,IAAUC,IAAKmG,EACxCxF,KAAKuC,OAAOlD,GAAK+F,EAAK9F,WAAWkG,GAEnClH,GAAKc,EACLY,KAAKsC,MAAM6C,OAAO,EAAG/F,IAQdqG,aACT,GAAmB,IAAfzF,KAAKyD,QAA2BzD,KAAKJ,QAAUI,KAAK4D,OACtD,OAAOnE,EAIT,MAAMiG,EAAe1F,KAAKsC,MAAMmC,gBAEhC,GAAmB,IAAfzE,KAAKyD,MAAwB,CAC/B,IAAIY,EAAYrE,KAAK4D,OAAS5D,KAAK8B,eACnC,GAAIuC,EAAY,EAAG,CACjB,MAAMD,EAAMpE,KAAKwB,cACjB,IAAIwC,EAAShE,KAAK6B,YACdyC,EAAI,EACR,KAAOA,EAAI,GAAKD,EAAY,GAC1BrE,KAAKyB,QAAQqB,IAAI9C,KAAK+C,MAAMwB,SAASH,EAAME,EAAGF,EAAME,EAAIoB,GAAe1B,EAAS0B,EAAepB,GAC/FA,IACAD,IAEEA,GACFrE,KAAKyB,QAAQkE,KAAK3F,KAAKkD,WAAYc,EAAS0B,EAAepB,GAG/D,OAAOtE,KAAKyB,QAAQ8C,SAAS,EAAGvE,KAAKJ,MAAQI,KAAK4D,QAGpD,GAAmB,IAAf5D,KAAKyD,MAAwB,CAC/B,GAAIzD,KAAK4B,YAAc5B,KAAK2B,UAAW,CACrC,IAAIiE,GAAS,EACb,GAAIF,EACF,GAAIA,IAAiB1F,KAAK4B,UACxBgE,GAAS,MACJ,CACL,MAAMxB,EAAMpE,KAAKwB,cACjB,IAAIwC,EAAShE,KAAK6B,YAClB7B,KAAK+D,SAASC,EAAuB,EAAf0B,GACtB,IAAK,IAAIrG,EAAI,EAAGA,EAAI,IAAKA,EACvBW,KAAKyB,QAAQqB,IAAI9C,KAAK+C,MAAMwB,SAASH,EAAM/E,EAAG+E,EAAM/E,EAAIqG,GAAe1B,EAAS0B,EAAerG,GAIrG,IAAKuG,EACH,OAAO5F,KAAKyB,QAAQ8C,SAAS,EAAGvE,KAAKJ,MAAQI,KAAK4D,QAMtD,MAAMiC,EAAQ,IAAI9H,YAAYiC,KAAKJ,MAAQI,KAAK4D,QAChDiC,EAAMF,KAAK3F,KAAKkD,YAChB,IAAI4C,EAAc,EACdT,EAAQ,EACZ,IAAK,IAAIhG,EAAI,EAAGA,EAAIW,KAAK0B,YAAYtC,SAAUC,EAAG,CAChD,MAAM0G,EAAK/F,KAAK0B,YAAYrC,GAC5B,IAAK,IAAIf,EAAI,EAAGA,EAAI,IAAKA,EACvBuH,EAAM/C,IAAI9C,KAAKyB,QAAQ8C,SAASc,EAAOA,GAASU,GAAKD,GACrDA,GAAe9F,KAAKJ,MAIxB,GAAI8F,EAAc,CAChB,MAAMtB,EAAMpE,KAAKwB,cAEXwE,EAAgBhG,KAAKsC,MAAMoC,iBACjC,IAAK,IAAIrF,EAAI,EAAGA,EAAI2G,IAAiB3G,EACnCwG,EAAM/C,IAAI9C,KAAK+C,MAAMwB,SAASH,EAAM/E,EAAG+E,EAAM/E,EAAIqG,GAAeI,EAAc9F,KAAKJ,MAAQP,GAG/F,OAAOwG,EAIT,OAAOpG,EAOEwG,YACT,OAAO,IAAIC,kBAAkBlG,KAAKyF,OAAOzH,OAAQ,EAAGgC,KAAKJ,MAAQI,KAAK4D,OAAS,GAe1EC,UACL7D,KAAKyB,QAAUhC,EACfO,KAAK0B,YAAYtC,OAAS,EAC1BY,KAAK2B,UAAY,EACjB3B,KAAK4B,UAAYhD,EAGjBoB,KAAKsC,MAAMW,KAAKtE,EAAoB,EAAGqB,KAAK+B,MAAMxB,aAAc,IAoB5D,SAAS4E,EACfC,EACA1E,GAEA,MAAMyF,EAAM,IAAIhF,EAAQT,GAGxB,OAFAyF,EAAIlD,OACY,iBAATmC,EAAoBe,EAAIZ,aAAaH,GAAQe,EAAIhB,OAAOC,GACxD,CACLxF,MAAOuG,EAAIvG,MACXgE,OAAQuC,EAAIvC,OACZ6B,OAAQU,EAAIV,OACZQ,MAAOE,EAAIF,OASRG,eAAeC,EACpBjB,EACA1E,GAEA,MAAMyF,QAAY1F,EAAaC,GAG/B,OAFAyF,EAAIlD,OACY,iBAATmC,EAAoBe,EAAIZ,aAAaH,GAAQe,EAAIhB,OAAOC,GACxD,CACLxF,MAAOuG,EAAIvG,MACXgE,OAAQuC,EAAIvC,OACZ6B,OAAQU,EAAIV,OACZQ,MAAOE,EAAIF","sources":["webpack://sixel/webpack/universalModuleDefinition","webpack://sixel/webpack/bootstrap","webpack://sixel/webpack/runtime/define property getters","webpack://sixel/webpack/runtime/hasOwnProperty shorthand","webpack://sixel/webpack/runtime/make namespace object","webpack://sixel/./src/Colors.ts","webpack://sixel/./src/wasm.ts","webpack://sixel/./src/Decoder.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"sixel\"] = factory();\n\telse\n\t\troot[\"sixel\"] = factory();\n})(self, () => {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/**\n * Copyright (c) 2019 Joerg Breitbart.\n * @license MIT\n */\n\nimport { RGBA8888, RGBColor } from './Types';\n\n\n// FIXME: cleanup this mess, move things either to decoder/encoder, keep only shared things\n\n\n// system endianess\nexport const BIG_ENDIAN = new Uint8Array(new Uint32Array([0xFF000000]).buffer)[0] === 0xFF;\nif (BIG_ENDIAN) {\n  console.warn('BE platform detected. This version of node-sixel works only on LE properly.');\n}\n\n// channel values\nexport function red(n: RGBA8888): number {\n  return n & 0xFF;\n}\n\nexport function green(n: RGBA8888): number {\n  return (n >>> 8) & 0xFF;\n}\n\nexport function blue(n: RGBA8888): number {\n  return (n >>> 16) & 0xFF;\n}\n\nexport function alpha(n: RGBA8888): number {\n  return (n >>> 24) & 0xFF;\n}\n\n\n/**\n * Convert RGB channels to native color RGBA8888.\n */\nexport function toRGBA8888(r: number, g: number, b: number, a: number = 255): RGBA8888 {\n  return ((a & 0xFF) << 24 | (b & 0xFF) << 16 | (g & 0xFF) << 8 | (r & 0xFF)) >>> 0;   // ABGR32\n}\n\n\n/**\n * Convert native color to [r, g, b, a].\n */\nexport function fromRGBA8888(color: RGBA8888): [number, number, number, number] {\n  return [color & 0xFF, (color >> 8) & 0xFF, (color >> 16) & 0xFF, color >>> 24];\n}\n\n\n/**\n * Get index of nearest color in `palette` for `color`.\n * Uses euclidean distance without any luminescence correction.\n */\nexport function nearestColorIndex(color: RGBA8888, palette: RGBColor[]): number {\n  const r = red(color);\n  const g = green(color);\n  const b = blue(color);\n\n  let min = Number.MAX_SAFE_INTEGER;\n  let idx = -1;\n\n  // use euclidean distance (manhattan gives very poor results)\n  for (let i = 0; i < palette.length; ++i) {\n    const dr = r - palette[i][0];\n    const dg = g - palette[i][1];\n    const db = b - palette[i][2];\n    const d = dr * dr + dg * dg + db * db;\n    if (!d) return i;\n    if (d < min) {\n      min = d;\n      idx = i;\n    }\n  }\n\n  return idx;\n}\n\n\n// color conversions\n// HLS taken from: http://www.niwa.nu/2013/05/math-behind-colorspace-conversions-rgb-hsl\n\nfunction clamp(low: number, high: number, value: number): number {\n  return Math.max(low, Math.min(value, high));\n}\n\nfunction h2c(t1: number, t2: number, c: number): number {\n  if (c < 0) c += 1;\n  if (c > 1) c -= 1;\n  return c * 6 < 1\n    ? t2 + (t1 - t2) * 6 * c\n    : c * 2 < 1\n      ? t1\n      : c * 3 < 2\n        ? t2 + (t1 - t2) * (4 - c * 6)\n        : t2;\n}\n\nfunction HLStoRGB(h: number, l: number, s: number): RGBA8888 {\n  if (!s) {\n    const v = Math.round(l * 255);\n    return toRGBA8888(v, v, v);\n  }\n  const t1 = l < 0.5 ? l * (1 + s) : l + s - l * s;\n  const t2 = 2 * l - t1;\n  return toRGBA8888(\n    clamp(0, 255, Math.round(h2c(t1, t2, h + 1 / 3) * 255)),\n    clamp(0, 255, Math.round(h2c(t1, t2, h) * 255)),\n    clamp(0, 255, Math.round(h2c(t1, t2, h - 1 / 3) * 255))\n  );\n}\n\n/**\n * Normalize SIXEL RGB values (percent based, 0-100) to RGBA8888.\n */\nexport function normalizeRGB(r: number, g: number, b: number): RGBA8888 {\n  return (0xFF000000 | Math.round(b / 100 * 255) << 16 | Math.round(g / 100 * 255) << 8 | Math.round(r / 100 * 255)) >>> 0;  // ABGR32\n}\n\n\n/**\n * Normalize SIXEL HLS values to RGBA8888. Applies hue correction of +240°.\n */\nexport function normalizeHLS(h: number, l: number, s: number): RGBA8888 {\n  // Note: hue value is turned by 240° in VT340, all values given as fractions\n  return HLStoRGB((h + 240 % 360) / 360, l / 100, s / 100);\n}\n\n\n/**\n * default palettes\n */\n\n// FIXME: move palettes to Decoder.ts\n\n/**\n * 16 predefined color registers of VT340 (values in %):\n * ```\n *                R   G   B\n * 0  Black       0   0   0\n * 1  Blue        20  20  80\n * 2  Red         80  13  13\n * 3  Green       20  80  20\n * 4  Magenta     80  20  80\n * 5  Cyan        20  80  80\n * 6  Yellow      80  80  20\n * 7  Gray 50%    53  53  53\n * 8  Gray 25%    26  26  26\n * 9  Blue*       33  33  60\n * 10 Red*        60  26  26\n * 11 Green*      33  60  33\n * 12 Magenta*    60  33  60\n * 13 Cyan*       33  60  60\n * 14 Yellow*     60  60  33\n * 15 Gray 75%    80  80  80\n * ```\n * (*) less saturated\n *\n * @see https://vt100.net/docs/vt3xx-gp/chapter2.html#S2.4\n*/\nexport const PALETTE_VT340_COLOR = new Uint32Array([\n  normalizeRGB( 0,  0,  0),\n  normalizeRGB(20, 20, 80),\n  normalizeRGB(80, 13, 13),\n  normalizeRGB(20, 80, 20),\n  normalizeRGB(80, 20, 80),\n  normalizeRGB(20, 80, 80),\n  normalizeRGB(80, 80, 20),\n  normalizeRGB(53, 53, 53),\n  normalizeRGB(26, 26, 26),\n  normalizeRGB(33, 33, 60),\n  normalizeRGB(60, 26, 26),\n  normalizeRGB(33, 60, 33),\n  normalizeRGB(60, 33, 60),\n  normalizeRGB(33, 60, 60),\n  normalizeRGB(60, 60, 33),\n  normalizeRGB(80, 80, 80)\n]);\n\n/**\n * 16 predefined monochrome registers of VT340 (values in %):\n * ```\n *              R   G   B\n * 0  Black     0   0   0\n * 1  Gray-2    13  13  13\n * 2  Gray-4    26  26  26\n * 3  Gray-6    40  40  40\n * 4  Gray-1    6   6   6\n * 5  Gray-3    20  20  20\n * 6  Gray-5    33  33  33\n * 7  White 7   46  46  46\n * 8  Black 0   0   0   0\n * 9  Gray-2    13  13  13\n * 10 Gray-4    26  26  26\n * 11 Gray-6    40  40  40\n * 12 Gray-1    6   6   6\n * 13 Gray-3    20  20  20\n * 14 Gray-5    33  33  33\n * 15 White 7   46  46  46\n * ```\n *\n * @see https://vt100.net/docs/vt3xx-gp/chapter2.html#S2.4\n */\nexport const PALETTE_VT340_GREY = new Uint32Array([\n  normalizeRGB( 0,  0,  0),\n  normalizeRGB(13, 13, 13),\n  normalizeRGB(26, 26, 26),\n  normalizeRGB(40, 40, 40),\n  normalizeRGB( 6,  6,  6),\n  normalizeRGB(20, 20, 20),\n  normalizeRGB(33, 33, 33),\n  normalizeRGB(46, 46, 46),\n  normalizeRGB( 0,  0,  0),\n  normalizeRGB(13, 13, 13),\n  normalizeRGB(26, 26, 26),\n  normalizeRGB(40, 40, 40),\n  normalizeRGB( 6,  6,  6),\n  normalizeRGB(20, 20, 20),\n  normalizeRGB(33, 33, 33),\n  normalizeRGB(46, 46, 46)\n]);\n\n/**\n * 256 predefined ANSI colors.\n *\n * @see https://en.wikipedia.org/wiki/ANSI_escape_code#8-bit\n */\nexport const PALETTE_ANSI_256 = (() => {\n  // 16 lower colors (taken from xterm)\n  const p: RGBA8888[] = [\n    toRGBA8888(0, 0, 0),\n    toRGBA8888(205, 0, 0),\n    toRGBA8888(0, 205, 0),\n    toRGBA8888(205, 205, 0),\n    toRGBA8888(0, 0, 238),\n    toRGBA8888(205, 0, 205),\n    toRGBA8888(0, 250, 205),\n    toRGBA8888(229, 229, 229),\n    toRGBA8888(127, 127, 127),\n    toRGBA8888(255, 0, 0),\n    toRGBA8888(0, 255, 0),\n    toRGBA8888(255, 255, 0),\n    toRGBA8888(92, 92, 255),\n    toRGBA8888(255, 0, 255),\n    toRGBA8888(0, 255, 255),\n    toRGBA8888(255, 255, 255),\n  ];\n  // colors up to 232\n  const d = [0, 95, 135, 175, 215, 255];\n  for (let r = 0; r < 6; ++r) {\n    for (let g = 0; g < 6; ++g) {\n      for (let b = 0; b < 6; ++b) {\n        p.push(toRGBA8888(d[r], d[g], d[b]));\n      }\n    }\n  }\n  // grey scale to up 255\n  for (let v = 8; v <= 238; v += 10) {\n    p.push(toRGBA8888(v, v, v));\n  }\n  return new Uint32Array(p);\n})();\n\n/**\n * Background: Black by default.\n * Foreground: White by default.\n *\n * Background color is used whenever a fill color is needed and not explicitly set.\n * Foreground color is used as default initial sixel color.\n */\nexport const DEFAULT_BACKGROUND: RGBA8888 = toRGBA8888(0, 0, 0, 255);\nexport const DEFAULT_FOREGROUND: RGBA8888 = toRGBA8888(255, 255, 255, 255);\n","\nexport const LIMITS = {\n  CHUNK_SIZE: 16384,\n  PALETTE_SIZE: 4096,\n  MAX_WIDTH: 16384,\n  BYTES: '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AEHAiwIgADcDAEG4iwIgADcDAEGwiwIgADcDAEGoiwIgADcDAEGgiwIgADcDAEGYiwIgADcDAEGQiwIgADcDAEGIiwIgADcDAEGAiwIgADcDAEH4igIgADcDAEHwigIgADcDAEHoigIgADcDAEHgigIgADcDAEHYigIgADcDAEHQigIgADcDAEHIigIgADcDAEHAigIgADcDAEG4igIgADcDAEGwigIgADcDAEGoigIgADcDAEGgigIgADcDAEGYigIgADcDAEGQigIgADcDAEGIigIgADcDAEGAigIgADcDAEH4iQIgADcDAEHwiQIgADcDAEHoiQIgADcDAEHgiQIgADcDAEHYiQIgADcDAEHQiQIgADcDAEHIiQIgADcDAEHAiQIgADcDAEG4iQIgADcDAEGwiQIgADcDAEGoCCgCACIEQf8AakGAAW0hCAJAIARBgQFIDQBBASEBIAhBAiAIQQJKG0EBayICQQFxIQMgBEGBAk4EQCACQX5xIQIDQCABQQl0IgdBEHJBoIkCakGwiQJBgAT8CgAAIAdBsI0CakGwiQJBgAT8CgAAIAFBAmohASACQQJrIgINAAsLIANFDQAgAUEJdEEQckGgiQJqQbCJAkGABPwKAAALAkAgBEEBSA0AIAhBASAIQQFKGyIDQQFxIQUCQCADQQFrIgdFBEBBACEBDAELIANB/v///wdxIQJBACEBA0AgAUEJdCIGQRByQbCJBmpBsIkCQYAE/AoAACAGQZAEckGwiQZqQbCJAkGABPwKAAAgAUECaiEBIAJBAmsiAg0ACwsgBQRAIAFBCXRBEHJBsIkGakGwiQJBgAT8CgAACyAEQQFIDQAgA0EBcSEFIAcEfyADQf7///8HcSECQQAhAQNAIAFBCXQiBkEQckHAiQpqQbCJAkGABPwKAAAgBkGQBHJBwIkKakGwiQJBgAT8CgAAIAFBAmohASACQQJrIgINAAsgAUEHdEEEcgVBBAshASAFBEAgAUECdEHAiQpqQbCJAkGABPwKAAALIARBAUgNACADQQFxIQUgBwR/IANB/v///wdxIQJBACEBA0AgAUEJdCIGQRByQdCJDmpBsIkCQYAE/AoAACAGQZAEckHQiQ5qQbCJAkGABPwKAAAgAUECaiEBIAJBAmsiAg0ACyABQQd0QQRyBUEECyEBIAUEQCABQQJ0QdCJ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'\n};\n","/**\n * Copyright (c) 2021 Joerg Breitbart.\n * @license MIT\n */\n\nimport { IDecodeResult, InstanceLike, IDecoderOptions, IDecoderOptionsInternal, IWasmDecoderExports, RGBA8888, UintTypedArray, ParseMode, IDecoderProperties, IWasmDecoder } from './Types';\nimport { DEFAULT_BACKGROUND, DEFAULT_FOREGROUND, PALETTE_VT340_COLOR } from './Colors';\nimport { LIMITS } from './wasm';\n\n\n/* istanbul ignore next */\nfunction decodeBase64(s: string): Uint8Array {\n  if (typeof Buffer !== 'undefined') {\n    return Buffer.from(s, 'base64');\n  }\n  const bytestring = atob(s);\n  const result = new Uint8Array(bytestring.length);\n  for (let i = 0; i < result.length; ++i) {\n    result[i] = bytestring.charCodeAt(i);\n  }\n  return result;\n}\n\nconst WASM_BYTES = decodeBase64(LIMITS.BYTES);\nlet WASM_MODULE: WebAssembly.Module | undefined;\n\n// empty canvas\nconst NULL_CANVAS = new Uint32Array();\n\n\n// proxy for lazy binding of decoder methods to wasm env callbacks\nclass CallbackProxy {\n  public bandHandler = (width: number) => 1;\n  public modeHandler = (mode: ParseMode) => 1;\n  public handle_band(width: number): number {\n    return this.bandHandler(width);\n  }\n  public mode_parsed(mode: number): number {\n    return this.modeHandler(mode);\n  }\n}\n\n\n// default decoder options\nconst DEFAULT_OPTIONS: IDecoderOptionsInternal = {\n  memoryLimit: 2048 * 65536,\n  sixelColor: DEFAULT_FOREGROUND,\n  fillColor: DEFAULT_BACKGROUND,\n  palette: PALETTE_VT340_COLOR,\n  paletteLimit: LIMITS.PALETTE_SIZE,\n  truncate: true\n};\n\n\n/**\n * Create a decoder instance asynchronously.\n * To be used in the browser main thread.\n */\nexport function DecoderAsync(opts?: IDecoderOptions): Promise<Decoder> {\n  const cbProxy = new CallbackProxy();\n  const importObj = {\n    env: {\n      handle_band: cbProxy.handle_band.bind(cbProxy),\n      mode_parsed: cbProxy.mode_parsed.bind(cbProxy)\n    }\n  };\n  return WebAssembly.instantiate(WASM_MODULE || WASM_BYTES, importObj)\n    .then((inst: InstanceLike) => {\n      WASM_MODULE = WASM_MODULE || inst.module;\n      return new Decoder(opts, inst.instance || inst, cbProxy);\n    });\n}\n\n\n/**\n * Decoder - web assembly based sixel stream decoder.\n *\n * Usage pattern:\n *  - call `init` to initialize decoder for new image\n *  - feed data chunks to `decode` or `decodeString`\n *  - grab pixels from `data32`\n *  - optional: call `release` to free memory (e.g. after big images)\n *  - start over with next image by calling `init`\n *\n * Properties:\n *  - max width of 2^14 - 4 pixels (compile time setting in wasm)\n *  - no explicit height limit (only limited by memory)\n *  - max 4096 colors palette (compile time setting in wasm)\n *\n * Explanation operation modes:\n * - M1   Mode chosen for level 1 images (no raster attributes),\n *        or for level 2 images with `truncate=false`.\n * - M2   Mode chosen for level 2 images with `truncate=true` (default).\n *        While this mode is not fully spec conform (decoder not expected to truncate),\n *        it is what spec conform encoders should create (should not excess raster).\n *        This mode has several advantages:\n *        - ~15% faster decoding speed\n *        - image dimensions can be evaluated early without processing the whole data\n *        - faster pixel access in `data32` (precalulated)\n *        - image height is not reported as multiple of 6 pixels\n * - M0   Undecided mode state after `init`.\n * The level of an image is determined during early decoding based on the fact,\n * whether the data contains valid raster attributes before any sixel data.\n * Until then the mode of an image is marked as M0, meaning the real operation mode\n * could not be decided yet.\n */\nexport class Decoder {\n  private _opts: IDecoderOptionsInternal;\n  private _instance: IWasmDecoder;\n  private _wasm: IWasmDecoderExports;\n  private _states: Uint32Array;\n  private _chunk: Uint8Array;\n  private _palette: Uint32Array;\n  private _PIXEL_OFFSET = LIMITS.MAX_WIDTH + 4;\n  private _pSrc: Uint32Array;\n  private _canvas: Uint32Array = NULL_CANVAS;\n  private _bandWidths: number[] = [];\n  private _maxWidth = 0;\n  private _minWidth = LIMITS.MAX_WIDTH;\n  private _lastOffset = 0;\n  private _currentHeight = 0;\n\n  // some readonly parser states for internal usage\n  private get _fillColor(): RGBA8888 { return this._states[0]; }\n  private get _truncate(): number { return this._states[8]; }\n  private get _rasterWidth(): number { return this._states[6]; }\n  private get _rasterHeight(): number { return this._states[7]; }\n  private get _width(): number { return this._states[2] ? this._states[2] - 4 : 0; }\n  private get _height(): number { return this._states[3]; }\n  private get _level(): number { return this._states[9]; }\n  private get _mode(): ParseMode { return this._states[10]; }\n  private get _paletteLimit(): number { return this._states[11]; }\n\n  private _initCanvas(mode: ParseMode): number {\n    if (mode === ParseMode.M2) {\n      const pixels = this.width * this.height;\n      if (pixels > this._canvas.length) {\n        if (this._opts.memoryLimit && pixels * 4 > this._opts.memoryLimit) {\n          this.release();\n          throw new Error('image exceeds memory limit');\n        }\n        this._canvas = new Uint32Array(pixels);\n      }\n      this._maxWidth = this._width;\n    } else if (mode === ParseMode.M1) {\n      if (this._level === 2) {\n        // got raster attributes, use them as initial size hint\n        const pixels = Math.min(this._rasterWidth, LIMITS.MAX_WIDTH) * this._rasterHeight;\n        if (pixels > this._canvas.length) {\n          if (this._opts.memoryLimit && pixels * 4 > this._opts.memoryLimit) {\n            this.release();\n            throw new Error('image exceeds memory limit');\n          }\n          this._canvas = new Uint32Array(pixels);\n        }\n      } else {\n        // else fallback to generic resizing, starting with 256*256 pixels\n        if (this._canvas.length < 65536) {\n          this._canvas = new Uint32Array(65536);\n        }\n      }\n    }\n    return 0; // 0 - continue, 1 - abort right away\n  }\n\n  private _realloc(offset: number, additionalPixels: number): void {\n    const pixels = offset + additionalPixels;\n    if (pixels > this._canvas.length) {\n      if (this._opts.memoryLimit && pixels * 4 > this._opts.memoryLimit) {\n        this.release();\n        throw new Error('image exceeds memory limit');\n      }\n      // extend in 65536 pixel blocks\n      const newCanvas = new Uint32Array(Math.ceil(pixels / 65536) * 65536);\n      newCanvas.set(this._canvas);\n      this._canvas = newCanvas;\n    }\n  }\n\n  private _handle_band(width: number): number {\n    const adv = this._PIXEL_OFFSET;\n    let offset = this._lastOffset;\n    if (this._mode === ParseMode.M2) {\n      let remaining = this.height - this._currentHeight;\n      let c = 0;\n      while (c < 6 && remaining > 0) {\n        this._canvas.set(this._pSrc.subarray(adv * c, adv * c + width), offset + width * c);\n        c++;\n        remaining--;\n      }\n      this._lastOffset += width * c;\n      this._currentHeight += c;\n    } else if (this._mode === ParseMode.M1) {\n      this._realloc(offset, width * 6);\n      this._maxWidth = Math.max(this._maxWidth, width);\n      this._minWidth = Math.min(this._minWidth, width);\n      for (let i = 0; i < 6; ++i) {\n        this._canvas.set(this._pSrc.subarray(adv * i, adv * i + width), offset + width * i);\n      }\n      this._bandWidths.push(width);\n      this._lastOffset += width * 6;\n      this._currentHeight += 6;\n    }\n    return 0; // 0 - continue, 1 - abort right away\n  }\n\n  /**\n   * Synchonous ctor. Can be called from nodejs or a webworker context.\n   * For instantiation in the browser main thread use `WasmDecoderAsync` instead.\n   */\n  constructor(\n    opts?: IDecoderOptions,\n    _instance?: WebAssembly.Instance,\n    _cbProxy?: CallbackProxy\n  ) {\n    this._opts = Object.assign({}, DEFAULT_OPTIONS, opts);\n    if (this._opts.paletteLimit > LIMITS.PALETTE_SIZE) {\n      throw new Error(`DecoderOptions.paletteLimit must not exceed ${LIMITS.PALETTE_SIZE}`);\n    }\n    if (!_instance) {\n      const module = WASM_MODULE || (WASM_MODULE = new WebAssembly.Module(WASM_BYTES));\n      _instance = new WebAssembly.Instance(module, {\n        env: {\n          handle_band: this._handle_band.bind(this),\n          mode_parsed: this._initCanvas.bind(this)\n        }\n      });\n    } else {\n      _cbProxy!.bandHandler = this._handle_band.bind(this);\n      _cbProxy!.modeHandler = this._initCanvas.bind(this);\n    }\n    this._instance = _instance as IWasmDecoder;\n    this._wasm = this._instance.exports;\n    this._chunk = new Uint8Array(this._wasm.memory.buffer, this._wasm.get_chunk_address(), LIMITS.CHUNK_SIZE);\n    this._states = new Uint32Array(this._wasm.memory.buffer, this._wasm.get_state_address(), 12);\n    this._palette = new Uint32Array(this._wasm.memory.buffer, this._wasm.get_palette_address(), LIMITS.PALETTE_SIZE);\n    this._palette.set(this._opts.palette);\n    this._pSrc = new Uint32Array(this._wasm.memory.buffer, this._wasm.get_p0_address());\n    this._wasm.init(DEFAULT_FOREGROUND, 0, this._opts.paletteLimit, 0);\n  }\n\n  /**\n   * Width of the image data.\n   * Returns the rasterWidth in level2/truncating mode,\n   * otherwise the max width, that has been seen so far.\n   */\n  public get width(): number {\n    return this._mode !== ParseMode.M1\n      ? this._width\n      : Math.max(this._maxWidth, this._wasm.current_width());\n  }\n\n  /**\n   * Height of the image data.\n   * Returns the rasterHeight in level2/truncating mode,\n   * otherwise height touched by sixels.\n   */\n  public get height(): number {\n    return this._mode !== ParseMode.M1\n      ? this._height\n      : this._wasm.current_width()\n        ? this._bandWidths.length * 6 + this._wasm.current_height()\n        : this._bandWidths.length * 6;\n  }\n\n  /**\n   * Get active palette colors as RGBA8888[] (borrowed).\n   */\n  public get palette(): Uint32Array {\n    return this._palette.subarray(0, this._paletteLimit);\n  }\n\n  /**\n   * Get the memory used by the decoder.\n   *\n   * This is a rough estimate accounting the wasm instance memory\n   * and pixel buffers held on JS side (real value will be slightly\n   * higher due to JS book-keeping).\n   * Note that the decoder does not free ressources on its own,\n   * call `release` to free excess memory.\n   */\n  public get memoryUsage(): number {\n    return this._canvas.byteLength + this._wasm.memory.buffer.byteLength + 8 * this._bandWidths.length;\n  }\n\n  /**\n   * Get various properties of the decoder and the current image.\n   */\n  public get properties(): IDecoderProperties {\n    return {\n      width: this.width,\n      height: this.height,\n      mode: this._mode,\n      level: this._level,\n      truncate: !!this._truncate,\n      paletteLimit: this._paletteLimit,\n      fillColor: this._fillColor,\n      memUsage: this.memoryUsage,\n      rasterAttributes: {\n        numerator: this._states[4],\n        denominator: this._states[5],\n        width: this._rasterWidth,\n        height: this._rasterHeight,\n      }\n    };\n  }\n\n  /**\n   * Initialize decoder for next image. Must be called before\n   * any calls to `decode` or `decodeString`.\n   */\n  // FIXME: reorder arguments, better palette handling\n  public init(\n    fillColor: RGBA8888 = this._opts.fillColor,\n    palette: Uint32Array | null = this._opts.palette,\n    paletteLimit: number = this._opts.paletteLimit,\n    truncate: boolean = this._opts.truncate\n  ): void {\n    this._wasm.init(this._opts.sixelColor, fillColor, paletteLimit, truncate ? 1 : 0);\n    if (palette) {\n      this._palette.set(palette.subarray(0, LIMITS.PALETTE_SIZE));\n    }\n    this._bandWidths.length = 0;\n    this._maxWidth = 0;\n    this._minWidth = LIMITS.MAX_WIDTH;\n    this._lastOffset = 0;\n    this._currentHeight = 0;\n  }\n\n  /**\n   * Decode next chunk of data from start to end index (exclusive).\n   * @throws Will throw if the image exceeds the memory limit.\n   */\n  public decode(data: UintTypedArray, start: number = 0, end: number = data.length): void {\n    let p = start;\n    while (p < end) {\n      const length = Math.min(end - p, LIMITS.CHUNK_SIZE);\n      this._chunk.set(data.subarray(p, p += length));\n      this._wasm.decode(0, length);\n    }\n  }\n\n  /**\n   * Decode next chunk of string data from start to end index (exclusive).\n   * Note: Decoding from string data is rather slow, use `decode` with byte data instead.\n   * @throws Will throw if the image exceeds the memory limit.\n   */\n  public decodeString(data: string, start: number = 0, end: number = data.length): void {\n    let p = start;\n    while (p < end) {\n      const length = Math.min(end - p, LIMITS.CHUNK_SIZE);\n      for (let i = 0, j = p; i < length; ++i, ++j) {\n        this._chunk[i] = data.charCodeAt(j);\n      }\n      p += length;\n      this._wasm.decode(0, length);\n    }\n  }\n\n  /**\n   * Get current pixel data as 32-bit typed array (RGBA8888).\n   * Also peeks into pixel data of the current band, that got not pushed yet.\n   */\n  public get data32(): Uint32Array {\n    if (this._mode === ParseMode.M0 || !this.width || !this.height) {\n      return NULL_CANVAS;\n    }\n\n    // get width of pending band to peek into left-over data\n    const currentWidth = this._wasm.current_width();\n\n    if (this._mode === ParseMode.M2) {\n      let remaining = this.height - this._currentHeight;\n      if (remaining > 0) {\n        const adv = this._PIXEL_OFFSET;\n        let offset = this._lastOffset;\n        let c = 0;\n        while (c < 6 && remaining > 0) {\n          this._canvas.set(this._pSrc.subarray(adv * c, adv * c + currentWidth), offset + currentWidth * c);\n          c++;\n          remaining--;\n        }\n        if (remaining) {\n          this._canvas.fill(this._fillColor, offset + currentWidth * c);\n        }\n      }\n      return this._canvas.subarray(0, this.width * this.height);\n    }\n\n    if (this._mode === ParseMode.M1) {\n      if (this._minWidth === this._maxWidth) {\n        let escape = false;\n        if (currentWidth) {\n          if (currentWidth !== this._minWidth) {\n            escape = true;\n          } else {\n            const adv = this._PIXEL_OFFSET;\n            let offset = this._lastOffset;\n            this._realloc(offset, currentWidth * 6);\n            for (let i = 0; i < 6; ++i) {\n              this._canvas.set(this._pSrc.subarray(adv * i, adv * i + currentWidth), offset + currentWidth * i);\n            }\n          }\n        }\n        if (!escape) {\n          return this._canvas.subarray(0, this.width * this.height);\n        }\n      }\n\n      // worst case: re-align pixels if we have bands with different width\n      // This is somewhat allocation intensive, any way to do that in-place, and just once?\n      const final = new Uint32Array(this.width * this.height);\n      final.fill(this._fillColor);\n      let finalOffset = 0;\n      let start = 0;\n      for (let i = 0; i < this._bandWidths.length; ++i) {\n        const bw = this._bandWidths[i];\n        for (let p = 0; p < 6; ++p) {\n          final.set(this._canvas.subarray(start, start += bw), finalOffset);\n          finalOffset += this.width;\n        }\n      }\n      // also handle left-over pixels of the current band\n      if (currentWidth) {\n        const adv = this._PIXEL_OFFSET;\n        // other than finished bands, this runs only up to currentHeight\n        const currentHeight = this._wasm.current_height();\n        for (let i = 0; i < currentHeight; ++i) {\n          final.set(this._pSrc.subarray(adv * i, adv * i + currentWidth), finalOffset + this.width * i);\n        }\n      }\n      return final;\n    }\n\n    // fallthrough for all not handled cases\n    return NULL_CANVAS;\n  }\n\n  /**\n   * Same as `data32`, but returning pixel data as Uint8ClampedArray suitable\n   * for direct usage with `ImageData`.\n   */\n  public get data8(): Uint8ClampedArray {\n    return new Uint8ClampedArray(this.data32.buffer, 0, this.width * this.height * 4);\n  }\n\n  /**\n   * Release image ressources on JS side held by the decoder.\n   *\n   * The decoder tries to re-use memory ressources of a previous image\n   * to lower allocation and GC pressure. Decoding a single big image\n   * will grow the memory usage of the decoder permanently.\n   * Call `release` to reset the internal buffers and free the memory.\n   * Note that this destroys the image data, call it when done processing\n   * a rather big image, otherwise it is not needed. Use `memoryUsage`\n   * to decide, whether the held memory is still within your limits.\n   * This does not affect the wasm module (operates on static memory).\n   */\n  public release(): void {\n    this._canvas = NULL_CANVAS;\n    this._bandWidths.length = 0;\n    this._maxWidth = 0;\n    this._minWidth = LIMITS.MAX_WIDTH;\n    // also nullify parser states in wasm to avoid\n    // width/height reporting potential out-of-bound values\n    this._wasm.init(DEFAULT_FOREGROUND, 0, this._opts.paletteLimit, 0);\n  }\n}\n\n\n/**\n * Convenient decoding functions for easier usage.\n *\n * These can be used for casual decoding of sixel images,\n * that dont come in as stream chunks.\n * Note that the functions instantiate a stream decoder for every call,\n * which comes with a performance penalty of ~25%.\n */\n\n\n/**\n * Decode function with synchronous wasm loading.\n * Can be used in a web worker or in nodejs. Does not work reliable in normal browser context.\n * @throws Will throw if the image exceeds the memory limit.\n */\n export function decode(\n  data: UintTypedArray | string,\n  opts?: IDecoderOptions\n): IDecodeResult {\n  const dec = new Decoder(opts);\n  dec.init();\n  typeof data === 'string' ? dec.decodeString(data) : dec.decode(data);\n  return {\n    width: dec.width,\n    height: dec.height,\n    data32: dec.data32,\n    data8: dec.data8\n  };\n}\n\n/**\n * Decode function with asynchronous wasm loading.\n * Use this version in normal browser context.\n * @throws Will throw if the image exceeds the memory limit.\n */\nexport async function decodeAsync(\n  data: UintTypedArray | string,\n  opts?: IDecoderOptions\n): Promise<IDecodeResult> {\n  const dec = await DecoderAsync(opts);\n  dec.init();\n  typeof data === 'string' ? dec.decodeString(data) : dec.decode(data);\n  return {\n    width: dec.width,\n    height: dec.height,\n    data32: dec.data32,\n    data8: dec.data8\n  };\n}\n"],"names":["root","factory","exports","module","define","amd","self","__webpack_require__","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","toRGBA8888","r","g","b","a","fromRGBA8888","color","normalizeRGB","Math","round","Uint8Array","Uint32Array","buffer","console","warn","PALETTE_VT340_COLOR","PALETTE_VT340_GREY","PALETTE_ANSI_256","p","d","push","v","DEFAULT_BACKGROUND","DEFAULT_FOREGROUND","LIMITS","WASM_BYTES","s","Buffer","from","bytestring","atob","result","length","i","charCodeAt","decodeBase64","WASM_MODULE","NULL_CANVAS","CallbackProxy","bandHandler","width","modeHandler","mode","handle_band","this","mode_parsed","DEFAULT_OPTIONS","memoryLimit","sixelColor","fillColor","palette","paletteLimit","truncate","DecoderAsync","opts","cbProxy","importObj","env","bind","WebAssembly","instantiate","then","inst","Decoder","instance","constructor","_instance","_cbProxy","_PIXEL_OFFSET","_canvas","_bandWidths","_maxWidth","_minWidth","_lastOffset","_currentHeight","_opts","assign","Error","_handle_band","_initCanvas","Module","Instance","_wasm","_chunk","memory","get_chunk_address","_states","get_state_address","_palette","get_palette_address","set","_pSrc","get_p0_address","init","_fillColor","_truncate","_rasterWidth","_rasterHeight","_width","_height","_level","_mode","_paletteLimit","pixels","height","release","min","_realloc","offset","additionalPixels","newCanvas","ceil","adv","remaining","c","subarray","max","current_width","current_height","memoryUsage","byteLength","properties","level","memUsage","rasterAttributes","numerator","denominator","decode","data","start","end","decodeString","j","data32","currentWidth","fill","escape","final","finalOffset","bw","currentHeight","data8","Uint8ClampedArray","dec","async","decodeAsync"],"sourceRoot":""}